<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ATM Practice - Adult Transition Program</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --success-color: #16a34a;
            --error-color: #dc2626;
            --warning-color: #ea580c;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body.high-contrast {
            --primary-color: #000000;
            --success-color: #006400;
            --error-color: #8b0000;
            --bg-color: #ffffff;
            --text-color: #000000;
            --card-bg: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Allow text selection for inputs and specific areas */
        input, textarea, .screen-message, .message-box {
            -webkit-user-select: text;
            user-select: text;
        }

        body.large-text {
            font-size: 18px;
        }

        body.extra-large-text {
            font-size: 22px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
        }

        header {
            background: var(--primary-color);
            color: white;
            padding: 15px 10px;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }

        h1 {
            font-size: clamp(1.2em, 5vw, 2em);
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: clamp(0.85em, 3vw, 1.1em);
            opacity: 0.95;
        }

        /* Accessibility Controls */
        .accessibility-bar {
            background: var(--card-bg);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            font-size: 0.9em;
        }

        .accessibility-bar label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.85em;
        }

        /* Mobile Scenario Card - Always at top on mobile */
        .mobile-scenario-card {
            display: none; /* Hidden on desktop */
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .mobile-scenario-card.active {
            display: block;
        }

        .mobile-scenario-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }

        .mobile-scenario-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .mobile-scenario-item:last-child {
            border-bottom: none;
        }

        .mobile-scenario-label {
            font-weight: 600;
            opacity: 0.9;
        }

        .mobile-scenario-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .mobile-current-task {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-size: 1.05em;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .mobile-progress {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        .mobile-progress-fill {
            background: #22c55e;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        /* Main Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Level Selection Screen */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .level-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-color);
        }

        .level-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .level-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .level-card ul {
            list-style: none;
            margin-top: 15px;
        }

        .level-card li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .level-card li:before {
            content: "‚úì ";
            color: var(--success-color);
            font-weight: bold;
            margin-right: 8px;
        }

        /* ATM Machine */
        .atm-container {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .atm-machine {
            flex: 2;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255,255,255,0.1);
            min-width: 500px;
            border: 8px solid #1a252f;
            position: relative;
        }

        /* Kiosk frame effect */
        .atm-machine::before {
            content: '';
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            border-radius: 20px;
            z-index: -1;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }

        /* Kiosk ventilation details */
        .atm-machine::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #1f2937 0px,
                #1f2937 8px,
                transparent 8px,
                transparent 12px
            );
            border-radius: 2px;
        }

        /* Bank Branding at Top */
        .atm-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            margin: -25px -25px 20px -25px;
            padding: 25px;
            border-radius: 7px 7px 0 0;
            text-align: center;
            border-bottom: 3px solid #1e40af;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            position: relative;
        }

        .bank-logo {
            color: white;
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }

        .bank-tagline {
            color: #dbeafe;
            font-size: 0.9em;
            font-style: italic;
        }

        /* Security Indicator */
        .security-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75em;
            color: #dbeafe;
        }

        .security-light {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            box-shadow: 0 0 8px #22c55e;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        /* Status Lights */
        .status-lights {
            position: absolute;
            bottom: 10px;
            right: 15px;
            display: flex;
            gap: 8px;
        }

        .status-light {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4b5563;
            border: 1px solid #1f2937;
        }

        .status-light.active {
            background: #22c55e;
            box-shadow: 0 0 6px #22c55e;
        }

        .atm-screen {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 8px;
            padding: 15px;
            min-height: 420px;
            margin-bottom: 25px;
            box-shadow: inset 0 4px 15px rgba(0, 0, 0, 0.7), 0 2px 4px rgba(255,255,255,0.05);
            border: 4px solid #0f172a;
            position: relative;
        }

        /* Screen bezel */
        .atm-screen::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 8px;
            background: linear-gradient(145deg, #475569, #1e293b);
            z-index: -1;
        }

        .screen-content {
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 5px;
            padding: 25px;
            min-height: 380px;
            color: var(--text-color);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #cbd5e1;
        }

        /* Screen top bar with bank name */
        .screen-header {
            background: linear-gradient(90deg, #1e40af 0%, #2563eb 100%);
            color: white;
            padding: 12px;
            margin: -25px -25px 20px -25px;
            border-radius: 3px 3px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .screen-bank-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .screen-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        .screen-message {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
        }

        /* ATM Components */
        .atm-components {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            background: linear-gradient(180deg, #374151 0%, #1f2937 100%);
            padding: 20px;
            border-radius: 8px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.4);
        }

        .component-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .atm-slot {
            background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
            border-radius: 6px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #374151;
            color: #e5e7eb;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.6), 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }

        .atm-slot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }

        .atm-slot:hover {
            background: linear-gradient(180deg, #374151 0%, #1f2937 100%);
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.4), 0 4px 8px rgba(96,165,250,0.3);
        }

        .atm-slot.highlight {
            border-color: #fbbf24;
            animation: pulse 1.5s infinite;
            background: linear-gradient(180deg, #451a03 0%, #78350f 100%);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5), inset 0 2px 6px rgba(0,0,0,0.4);
        }

        .atm-slot.correct {
            border-color: var(--success-color);
            background: linear-gradient(180deg, #064e3b 0%, #065f46 100%);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .atm-slot.incorrect {
            border-color: var(--error-color);
            background: linear-gradient(180deg, #7f1d1d 0%, #991b1b 100%);
            animation: shake 0.5s;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7), inset 0 2px 6px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 0 0 15px rgba(251, 191, 36, 0), inset 0 2px 6px rgba(0,0,0,0.4); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .slot-icon {
            font-size: 2.8em;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .slot-label {
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slot-description {
            font-size: 0.75em;
            color: #9ca3af;
            margin-top: 4px;
        }

        /* Side buttons (like real ATMs) */
        .side-buttons {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-top: 20px;
        }

        .side-button-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .side-button {
            width: 60px;
            height: 45px;
            background: linear-gradient(180deg, #4b5563 0%, #374151 100%);
            border: 2px solid #1f2937;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }

        .side-button::after {
            content: '‚ñ∂';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #9ca3af;
            font-size: 1.2em;
        }

        .side-button.left::after {
            content: '‚óÄ';
        }

        .side-button:hover {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            border-color: #60a5fa;
        }

        .side-button:active {
            transform: scale(0.95);
        }

        /* Keypad */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-radius: 8px;
            box-shadow: inset 0 3px 10px rgba(0,0,0,0.5);
        }

        .key {
            background: linear-gradient(180deg, #4b5563 0%, #374151 100%);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 20px;
            font-size: 1.6em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4), inset 0 1px 2px rgba(255,255,255,0.1);
            border: 2px solid #1f2937;
            position: relative;
        }

        .key::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            border-radius: 6px 6px 0 0;
        }

        .key:hover {
            background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255,255,255,0.2);
        }

        .key:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .key.enter {
            grid-column: span 2;
            background: linear-gradient(180deg, #16a34a 0%, #15803d 100%);
            border-color: #14532d;
        }

        .key.enter:hover {
            background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
        }

        .key.clear {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
            border-color: #7f1d1d;
        }

        .key.clear:hover {
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
        }

        /* Side Panel */
        .side-panel {
            flex: 1;
            min-width: 300px;
        }

        .info-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .info-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--success-color), #22c55e);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9em;
            color: #64748b;
            margin-top: 5px;
        }

        /* Hints */
        .hint-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .hint-box.show {
            display: block;
        }

        .hint-title {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 8px;
        }

        /* Messages */
        .message-box {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .message-success {
            background: #dcfce7;
            color: #166534;
            border-left: 4px solid var(--success-color);
        }

        .message-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--error-color);
        }

        .message-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--primary-color);
        }

        /* Input Display */
        .input-display {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            color: #22c55e;
            font-family: 'Courier New', monospace;
            font-size: 2.2em;
            padding: 20px 25px;
            border-radius: 6px;
            text-align: right;
            margin: 20px 0;
            min-height: 65px;
            border: 3px solid #334155;
            box-shadow: inset 0 3px 10px rgba(0, 0, 0, 0.7), 0 1px 2px rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            letter-spacing: 3px;
            font-weight: bold;
        }

        /* Button Grid for Menu Options */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .menu-button {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .menu-button.highlight {
            border: 3px solid #fbbf24;
            animation: pulse 1.5s infinite;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        /* Celebration */
        .celebration {
            text-align: center;
            padding: 40px;
        }

        .celebration-icon {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Arrow Pointer for Learn Mode */
        .pointer-arrow {
            display: none;
            position: absolute;
            font-size: 3em;
            color: #fbbf24;
            animation: point 1s infinite;
            z-index: 100;
        }

        .pointer-arrow.active {
            display: block;
        }

        @keyframes point {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Timer */
        .timer {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 20px 0;
        }

        .timer.warning {
            color: var(--warning-color);
            animation: pulse 0.5s infinite;
        }

        .timer.danger {
            color: var(--error-color);
        }

        /* Responsive Design */
        /* Responsive Design - Mobile First Approach */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }

            .container {
                padding: 5px;
            }

            header {
                padding: 12px 8px;
                margin-bottom: 10px;
            }

            h1 {
                font-size: 1.3em;
            }

            .subtitle {
                font-size: 0.85em;
            }

            /* Show mobile scenario card */
            .mobile-scenario-card.active {
                display: block;
            }

            /* Hide desktop side panel on mobile */
            .side-panel {
                display: none !important;
            }

            .accessibility-bar {
                padding: 8px;
                gap: 8px;
                margin-bottom: 10px;
            }

            .accessibility-bar label {
                font-size: 0.75em;
                gap: 4px;
            }

            .atm-container {
                flex-direction: column;
                gap: 0;
                margin-top: 10px;
            }

            .atm-machine {
                min-width: 100%;
                padding: 15px;
                margin-bottom: 0;
                border-radius: 12px;
            }

            .atm-machine::before {
                top: -8px;
                left: -8px;
                right: -8px;
                bottom: -8px;
                border-radius: 15px;
            }

            .atm-machine::after {
                display: none; /* Remove ventilation on mobile */
            }

            .atm-header {
                margin: -15px -15px 15px -15px;
                padding: 15px 10px;
            }

            .bank-logo {
                font-size: 1.2em;
                letter-spacing: 0.5px;
            }

            .bank-tagline {
                font-size: 0.8em;
            }

            .security-indicator {
                font-size: 0.65em;
                top: 8px;
                right: 10px;
            }

            .security-light {
                width: 6px;
                height: 6px;
            }

            .status-lights {
                bottom: 8px;
                right: 10px;
            }

            .status-light {
                width: 8px;
                height: 8px;
            }

            .atm-screen {
                padding: 10px;
                min-height: 350px;
                margin-bottom: 15px;
            }

            .screen-content {
                padding: 15px;
                min-height: 320px;
            }

            .screen-header {
                padding: 10px;
                margin: -15px -15px 15px -15px;
                font-size: 0.85em;
            }

            .screen-title {
                font-size: 1.4em;
            }

            .screen-message {
                font-size: 1em;
            }

            .atm-components {
                padding: 12px;
                gap: 10px;
            }

            .component-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .atm-slot {
                padding: 15px;
                min-height: 80px;
            }

            .slot-icon {
                font-size: 2.2em;
            }

            .slot-label {
                font-size: 0.85em;
            }

            .slot-description {
                font-size: 0.7em;
            }

            /* Keypad optimized for touch */
            .keypad {
                gap: 10px;
                padding: 15px;
                margin-top: 15px;
            }

            .key {
                padding: 18px;
                font-size: 1.5em;
                min-height: 60px;
                touch-action: manipulation;
            }

            /* Input display */
            .input-display {
                font-size: 1.8em;
                padding: 15px 20px;
                min-height: 55px;
                margin: 15px 0;
            }

            /* Menu buttons */
            .menu-grid {
                gap: 12px;
                margin-top: 15px;
            }

            .menu-button {
                padding: 18px;
                font-size: 1em;
                min-height: 65px;
            }

            /* Level selection */
            .level-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .level-card {
                padding: 20px;
            }

            .level-card .icon {
                font-size: 2.5em;
            }

            .level-card h3 {
                font-size: 1.3em;
            }

            .level-card p {
                font-size: 0.95em;
            }

            .level-card li {
                font-size: 0.9em;
                padding: 6px 0;
            }

            /* Stats and info cards */
            .info-card {
                padding: 15px;
                margin-bottom: 12px;
            }

            .info-card h3 {
                font-size: 1.1em;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-box {
                padding: 12px;
            }

            .stat-value {
                font-size: 1.6em;
            }

            .stat-label {
                font-size: 0.85em;
            }

            /* Buttons */
            .btn {
                padding: 14px 20px;
                font-size: 1em;
                touch-action: manipulation;
            }

            /* Modal */
            .modal-content {
                width: 95%;
                padding: 25px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-title {
                font-size: 1.5em;
            }

            .modal-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .modal-buttons .btn {
                width: 100%;
            }

            /* Timer */
            .timer {
                font-size: 1.6em;
                margin: 15px 0;
            }

            /* Messages */
            .message-box {
                padding: 12px;
                font-size: 0.95em;
                margin: 12px 0;
            }

            .hint-box {
                padding: 12px;
                margin: 15px 0;
            }

            /* Audio controls */
            .audio-controls {
                bottom: 15px;
                right: 15px;
                padding: 12px;
            }

            #audioIcon {
                font-size: 1.8em;
            }

            /* Welcome screen */
            .screen.active {
                animation: none; /* Disable animation on mobile for performance */
            }

            /* Celebration */
            .celebration-icon {
                font-size: 3.5em;
            }
        }

        /* Tablet optimization (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 15px;
            }

            .atm-container {
                gap: 20px;
            }

            .atm-machine {
                min-width: 450px;
            }

            .side-panel {
                min-width: 280px;
            }

            .screen-title {
                font-size: 1.6em;
            }

            .slot-icon {
                font-size: 2.3em;
            }
        }

        /* Large phone landscape orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            .atm-screen {
                min-height: 280px;
            }

            .screen-content {
                min-height: 250px;
            }

            .mobile-scenario-card {
                padding: 10px;
            }

            .mobile-scenario-item {
                padding: 5px 0;
                font-size: 0.9em;
            }

            .keypad {
                gap: 8px;
                padding: 10px;
            }

            .key {
                padding: 12px;
                min-height: 45px;
            }
        }

        /* Very small phones (< 375px) */
        @media (max-width: 374px) {
            h1 {
                font-size: 1.1em;
            }

            .bank-logo {
                font-size: 1em;
            }

            .atm-screen {
                min-height: 320px;
            }

            .screen-content {
                padding: 12px;
                min-height: 290px;
            }

            .screen-title {
                font-size: 1.2em;
            }

            .screen-message {
                font-size: 0.9em;
            }

            .key {
                padding: 15px;
                font-size: 1.3em;
                min-height: 55px;
            }

            .menu-button {
                padding: 15px;
                font-size: 0.9em;
                min-height: 60px;
            }
        }
            }
        }

        /* Audio Controls */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            cursor: pointer;
            z-index: 999;
        }

        .audio-controls:hover {
            transform: scale(1.1);
        }

        /* Practice Log */
        .practice-log {
            margin-top: 20px;
        }

        .log-entry {
            background: #f1f5f9;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid var(--success-color);
        }

        .log-entry.error {
            border-left-color: var(--error-color);
        }

        /* Badge Display */
        .badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            box-shadow: var(--shadow);
        }

        .badge.locked {
            background: #94a3b8;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <header>
        <h1>üè¶ Career Connections Bank ATM</h1>
        <p class="subtitle">ATM Deposit Practice - Adult Transition Program</p>
    </header>

    <div class="container">
        <!-- Accessibility Controls -->
        <div class="accessibility-bar">
            <label>
                <input type="checkbox" id="highContrast"> High Contrast
            </label>
            <label>
                <input type="checkbox" id="largeText"> Large Text
            </label>
            <label>
                <input type="checkbox" id="extraLargeText"> Extra Large Text
            </label>
            <label>
                <input type="checkbox" id="audioEnabled"> Audio Instructions
            </label>
            <label>
                <input type="checkbox" id="slowMode"> Slower Pace
            </label>
        </div>

        <!-- Welcome Screen -->
        <div class="screen active" id="welcomeScreen">
            <div class="info-card">
                <h2>Welcome to Career Connections Bank ATM Practice! üéâ</h2>
                <p style="font-size: 1.1em; margin: 20px 0;">
                    This interactive practice tool will help you learn how to make deposits at a Career Connections Bank ATM machine. 
                    You'll practice with realistic scenarios and build confidence at your own pace.
                </p>
                <div class="message-box message-info">
                    <strong>Remember:</strong> Making mistakes is part of learning! This is a safe place to practice as many times as you need.
                </div>
                <button class="btn btn-primary" onclick="showLevelSelection()" style="margin-top: 20px; width: 100%; padding: 20px; font-size: 1.2em;">
                    Start Practicing ‚Üí
                </button>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <h3>Your Progress</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalPractices">0</div>
                        <div class="stat-label">Total Practices</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Level Selection Screen -->
        <div class="screen" id="levelScreen">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 2em;">Choose Your Practice Level</h2>
            <div class="level-grid">
                <div class="level-card" onclick="startLevel('learn')">
                    <div class="icon">üåü</div>
                    <h3>Learn Mode</h3>
                    <p>Perfect for first-timers! We'll guide you through every single step.</p>
                    <ul>
                        <li>Arrows point to each button</li>
                        <li>Audio instructions available</li>
                        <li>Can't make mistakes</li>
                        <li>Take all the time you need</li>
                        <li>Celebrate every step</li>
                    </ul>
                </div>

                <div class="level-card" onclick="startLevel('beginner')">
                    <div class="icon">üìö</div>
                    <h3>Beginner</h3>
                    <p>Ready to try on your own with some help nearby.</p>
                    <ul>
                        <li>Written hints available</li>
                        <li>Highlights on correct areas</li>
                        <li>Can retry immediately</li>
                        <li>Simple round amounts</li>
                        <li>No time pressure</li>
                    </ul>
                </div>

                <div class="level-card" onclick="startLevel('intermediate')">
                    <div class="icon">üí™</div>
                    <h3>Intermediate</h3>
                    <p>Building independence with realistic scenarios.</p>
                    <ul>
                        <li>Less guidance</li>
                        <li>Real-world amounts</li>
                        <li>Multiple transaction types</li>
                        <li>Basic time awareness</li>
                        <li>Learn from mistakes</li>
                    </ul>
                </div>

                <div class="level-card" onclick="startLevel('advanced')">
                    <div class="icon">üèÜ</div>
                    <h3>Advanced/Real World</h3>
                    <p>Just like at a real ATM - you've got this!</p>
                    <ul>
                        <li>Minimal guidance</li>
                        <li>Real-world scenarios</li>
                        <li>Timed transactions</li>
                        <li>Handle errors yourself</li>
                        <li>Multiple steps in sequence</li>
                    </ul>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="showWelcome()" style="margin-top: 30px; display: block; margin-left: auto; margin-right: auto;">
                ‚Üê Back to Home
            </button>
        </div>

        <!-- Practice Screen -->
        <div class="screen" id="practiceScreen">
            <!-- Mobile Scenario Card - Shows at top on phones -->
            <div class="mobile-scenario-card" id="mobileScenarioCard">
                <div class="mobile-scenario-title">üìã Your Task</div>
                <div class="mobile-scenario-item">
                    <span class="mobile-scenario-label">Balance:</span>
                    <span class="mobile-scenario-value" id="mobileBalance">$0.00</span>
                </div>
                <div class="mobile-scenario-item">
                    <span class="mobile-scenario-label">Amount:</span>
                    <span class="mobile-scenario-value" id="mobileAmount">$0.00</span>
                </div>
                <div class="mobile-scenario-item">
                    <span class="mobile-scenario-label">PIN:</span>
                    <span class="mobile-scenario-value" id="mobilePIN">****</span>
                </div>
                <div class="mobile-scenario-item">
                    <span class="mobile-scenario-label">Type:</span>
                    <span class="mobile-scenario-value" id="mobileTransactionType">DEPOSIT</span>
                </div>
                <div class="mobile-current-task" id="mobileCurrentTask">Getting started...</div>
                <div class="mobile-progress">
                    <div class="mobile-progress-fill" id="mobileProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="atm-container">
                <!-- ATM Machine -->
                <div class="atm-machine">
                    <!-- Bank Branding Header -->
                    <div class="atm-header">
                        <div class="security-indicator">
                            <div class="security-light"></div>
                            <span>üîí Secure</span>
                        </div>
                        <div class="bank-logo">üè¶ CAREER CONNECTIONS BANK</div>
                        <div class="bank-tagline">Building Your Financial Future</div>
                        <div class="status-lights">
                            <div class="status-light active" title="Power"></div>
                            <div class="status-light active" title="Network"></div>
                            <div class="status-light active" title="Ready"></div>
                        </div>
                    </div>

                    <div class="atm-screen">
                        <div class="screen-content" id="atmScreenContent">
                            <div class="screen-header">
                                <div class="screen-bank-name">
                                    <span>üè¶</span>
                                    <span>Career Connections Bank ATM</span>
                                </div>
                                <div style="font-size: 0.85em;">Secure Transaction</div>
                            </div>
                            <div class="screen-title" id="screenTitle">Welcome!</div>
                            <div class="screen-message" id="screenMessage"></div>
                            <div id="screenInteractive"></div>
                        </div>
                    </div>

                    <!-- ATM Physical Components -->
                    <div class="atm-components" id="atmComponents">
                        <div class="component-row">
                            <div class="atm-slot" data-slot="card" onclick="clickSlot('card')">
                                <div class="slot-icon">üí≥</div>
                                <div class="slot-label">Card Reader</div>
                                <div class="slot-description">Insert card here</div>
                            </div>
                            <div class="atm-slot" data-slot="receipt" onclick="clickSlot('receipt')">
                                <div class="slot-icon">üßæ</div>
                                <div class="slot-label">Receipt</div>
                                <div class="slot-description">Take receipt</div>
                            </div>
                        </div>
                        <div class="component-row">
                            <div class="atm-slot" data-slot="cash" onclick="clickSlot('cash')">
                                <div class="slot-icon">üíµ</div>
                                <div class="slot-label">Deposit Slot</div>
                                <div class="slot-description">Insert cash/checks</div>
                            </div>
                            <div class="atm-slot" data-slot="dispenser" onclick="clickSlot('dispenser')">
                                <div class="slot-icon">üí∏</div>
                                <div class="slot-label">Cash Dispenser</div>
                                <div class="slot-description">Withdraw cash</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="side-panel">
                    <!-- Current Task -->
                    <div class="info-card">
                        <h3>Current Task</h3>
                        <p id="currentTask" style="font-size: 1.1em; margin: 15px 0;">Getting started...</p>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                        </div>

                        <div id="timerContainer" style="display: none;">
                            <div class="timer" id="timer">60</div>
                        </div>
                    </div>

                    <!-- Hints -->
                    <div class="info-card" id="hintCard" style="display: none;">
                        <h3>üí° Hint</h3>
                        <div class="hint-box" id="hintContent"></div>
                        <button class="btn btn-secondary" onclick="showHint()" id="hintButton">Show Hint</button>
                    </div>

                    <!-- Scenario Info -->
                    <div class="info-card">
                        <h3>Your Scenario</h3>
                        <div id="scenarioInfo">
                            <p><strong>Account Balance:</strong> <span id="accountBalance">$1,250.00</span></p>
                            <p><strong>Deposit Amount:</strong> <span id="depositAmount">$50.00</span></p>
                            <p><strong>PIN:</strong> <span id="pinNumber">****</span></p>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="info-card">
                        <h3>Session Stats</h3>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-value" id="stepsCompleted">0</div>
                                <div class="stat-label">Steps Done</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="attemptsCount">0</div>
                                <div class="stat-label">Attempts</div>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="info-card">
                        <button class="btn btn-warning" onclick="restartPractice()" style="width: 100%; margin-bottom: 10px;">
                            üîÑ Start Over
                        </button>
                        <button class="btn btn-secondary" onclick="exitPractice()" style="width: 100%;">
                            ‚Üê Exit to Levels
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completionModal">
        <div class="modal-content">
            <div class="celebration">
                <div class="celebration-icon">üéâ</div>
                <h2 class="modal-title">Congratulations!</h2>
                <p style="font-size: 1.2em; margin: 20px 0;" id="completionMessage">
                    You successfully completed the ATM deposit!
                </p>
                <div class="stats-grid" style="margin: 30px 0;">
                    <div class="stat-box">
                        <div class="stat-value" id="finalSteps">0</div>
                        <div class="stat-label">Steps Completed</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="finalTime">0s</div>
                        <div class="stat-label">Time Taken</div>
                    </div>
                </div>
                <div id="badgeEarned" style="display: none; margin: 20px 0;">
                    <h3 style="color: var(--success-color);">üèÜ New Badge Earned!</h3>
                    <div class="badge" id="newBadge"></div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-success" onclick="practiceAgain()">Practice Again</button>
                    <button class="btn btn-primary" onclick="tryNextLevel()">Try Next Level</button>
                    <button class="btn btn-secondary" onclick="exitToLevels()">Back to Levels</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Controls -->
    <div class="audio-controls" id="audioBtn" onclick="toggleAudio()" style="display: none;">
        <span id="audioIcon" style="font-size: 2em;">üîä</span>
    </div>

    <script>
        // Game State
        let gameState = {
            currentLevel: null,
            currentStep: 0,
            totalSteps: 0,
            attempts: 0,
            startTime: null,
            timerInterval: null,
            timeLimit: 0,
            audioEnabled: false,
            slowMode: false,
            currentScenario: null,
            pinInput: '',
            amountInput: '',
            stats: {
                totalPractices: parseInt(localStorage.getItem('totalPractices') || '0'),
                successfulPractices: parseInt(localStorage.getItem('successfulPractices') || '0'),
                badges: JSON.parse(localStorage.getItem('badges') || '[]')
            }
        };

        // Scenarios for different levels
        const scenarios = {
            learn: [
                { balance: 500, deposit: 50, pin: '1234', type: 'cash', transactionType: 'deposit', description: 'Depositing birthday money' },
                { balance: 500, withdrawal: 40, pin: '1234', type: 'cash', transactionType: 'withdrawal', description: 'Getting cash for shopping' }
            ],
            beginner: [
                { balance: 800, deposit: 100, pin: '4685', type: 'cash', transactionType: 'deposit', description: 'Depositing part of paycheck' },
                { balance: 1250, deposit: 50, pin: '2846', type: 'cash', transactionType: 'deposit', description: 'Saving for a goal' },
                { balance: 600, withdrawal: 60, pin: '4685', type: 'cash', transactionType: 'withdrawal', description: 'Taking out money for groceries' },
                { balance: 850, withdrawal: 100, pin: '2846', type: 'cash', transactionType: 'withdrawal', description: 'Getting cash for the weekend' }
            ],
            intermediate: [
                { balance: 675.25, deposit: 47.50, pin: '7392', type: 'cash', transactionType: 'deposit', description: 'Depositing refund check' },
                { balance: 1420.80, deposit: 125.75, pin: '5618', type: 'mixed', transactionType: 'deposit', description: 'Cash and check deposit' },
                { balance: 325.00, deposit: 200.00, pin: '9174', type: 'cash', transactionType: 'deposit', description: 'Emergency bill payment prep' },
                { balance: 845.50, withdrawal: 80.00, pin: '7392', type: 'cash', transactionType: 'withdrawal', description: 'Cash for weekly expenses' },
                { balance: 1050.75, withdrawal: 120.00, pin: '5618', type: 'cash', transactionType: 'withdrawal', description: 'Money for car repair' }
            ],
            advanced: [
                { balance: 892.33, deposit: 83.67, pin: '3791', type: 'check', transactionType: 'deposit', description: 'First paycheck deposit' },
                { balance: 1567.45, deposit: 234.55, pin: '6284', type: 'mixed', transactionType: 'deposit', description: 'Multiple checks and cash' },
                { balance: 450.12, deposit: 175.88, pin: '8405', type: 'cash', transactionType: 'deposit', description: 'Rent savings deposit' },
                { balance: 975.40, withdrawal: 150.00, pin: '3791', type: 'cash', transactionType: 'withdrawal', description: 'Rent payment cash' },
                { balance: 1840.25, withdrawal: 200.00, pin: '6284', type: 'cash', transactionType: 'withdrawal', description: 'Monthly budget withdrawal' },
                { balance: 632.80, withdrawal: 85.50, pin: '8405', type: 'cash', transactionType: 'withdrawal', description: 'Utility payment cash' }
            ]
        };

        // Step sequences for each level - will be customized based on transaction type
        function getStepsForTransaction(level, transactionType) {
            const isWithdrawal = transactionType === 'withdrawal';
            
            const stepTemplates = {
                learn: [
                    { action: 'insertCard', instruction: 'Insert your debit card into the card slot', hint: 'Look for the slot with the card icon üí≥' },
                    { action: 'enterPin', instruction: 'Enter your 4-digit PIN', hint: 'Your PIN is shown above. Type it carefully!' },
                    { action: 'selectTransaction', instruction: isWithdrawal ? 'Select "WITHDRAWAL" from the menu' : 'Select "DEPOSIT" from the menu', hint: isWithdrawal ? 'Look for the withdrawal option in the menu' : 'Look for the deposit option in the menu' },
                    { action: 'enterAmount', instruction: isWithdrawal ? 'Enter the withdrawal amount' : 'Enter the deposit amount', hint: 'Type the amount shown in your scenario' },
                    { action: 'completeTransaction', instruction: isWithdrawal ? 'Take your cash from the dispenser' : 'Insert your cash into the deposit slot', hint: isWithdrawal ? 'Look for the cash dispenser slot üí∏' : 'Look for the slot with the money icon üíµ' },
                    { action: 'takeReceipt', instruction: 'Take your receipt', hint: 'Look for the receipt slot üßæ' },
                    { action: 'takeCard', instruction: 'Don\'t forget your card!', hint: 'Always remember to take your card! üí≥' }
                ],
                beginner: [
                    { action: 'insertCard', instruction: 'Insert your debit card', hint: 'Find the card slot' },
                    { action: 'enterPin', instruction: 'Enter your PIN', hint: 'Your PIN is displayed in the sidebar' },
                    { action: 'selectTransaction', instruction: isWithdrawal ? 'Choose WITHDRAWAL from the menu' : 'Choose DEPOSIT from the menu', hint: isWithdrawal ? 'Look for the withdrawal button' : 'Look for the deposit button' },
                    { action: 'enterAmount', instruction: isWithdrawal ? 'Enter your withdrawal amount' : 'Enter your deposit amount', hint: 'Use the keypad to type the amount' },
                    { action: 'completeTransaction', instruction: isWithdrawal ? 'Take cash from dispenser' : 'Insert cash into deposit slot', hint: isWithdrawal ? 'Cash comes out of the dispenser' : 'Find the deposit slot' },
                    { action: 'takeReceipt', instruction: 'Take your receipt', hint: 'Receipt slot is usually at the top' },
                    { action: 'takeCard', instruction: 'Remove your debit card', hint: 'Don\'t leave your card behind!' }
                ],
                intermediate: [
                    { action: 'insertCard', instruction: 'Insert your debit card', hint: 'Card goes in the card slot' },
                    { action: 'enterPin', instruction: 'Enter PIN', hint: 'Check your scenario for the PIN' },
                    { action: 'selectTransaction', instruction: isWithdrawal ? 'Select WITHDRAWAL' : 'Select DEPOSIT', hint: 'Navigate the menu options' },
                    { action: 'enterAmount', instruction: isWithdrawal ? 'Enter withdrawal amount' : 'Enter deposit amount', hint: 'Be precise with cents' },
                    { action: 'completeTransaction', instruction: isWithdrawal ? 'Take your cash' : 'Insert cash/check', hint: isWithdrawal ? 'Get cash from dispenser' : 'Use the deposit slot' },
                    { action: 'takeReceipt', instruction: 'Get receipt', hint: isWithdrawal ? 'Receipt confirms your withdrawal' : 'Receipt confirms your deposit' },
                    { action: 'takeCard', instruction: 'Retrieve card', hint: 'Always take your card' }
                ],
                advanced: [
                    { action: 'insertCard', instruction: 'Begin transaction', hint: 'Insert card to start' },
                    { action: 'enterPin', instruction: 'Authenticate', hint: 'Enter your PIN' },
                    { action: 'selectTransaction', instruction: 'Choose transaction type', hint: isWithdrawal ? 'Select WITHDRAWAL' : 'Select DEPOSIT' },
                    { action: 'enterAmount', instruction: 'Specify amount', hint: 'Enter exact amount' },
                    { action: 'completeTransaction', instruction: isWithdrawal ? 'Retrieve cash' : 'Complete deposit', hint: isWithdrawal ? 'Take cash from dispenser' : 'Insert cash/check' },
                    { action: 'takeReceipt', instruction: 'Get proof of transaction', hint: 'Take receipt' },
                    { action: 'takeCard', instruction: 'Secure your card', hint: 'Remove card' }
                ]
            };
            
            return stepTemplates[level];
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            setupAccessibilityControls();
        });

        function setupAccessibilityControls() {
            document.getElementById('highContrast').addEventListener('change', function(e) {
                document.body.classList.toggle('high-contrast', e.target.checked);
            });

            document.getElementById('largeText').addEventListener('change', function(e) {
                document.body.classList.toggle('large-text', e.target.checked);
                if (e.target.checked) {
                    document.getElementById('extraLargeText').checked = false;
                    document.body.classList.remove('extra-large-text');
                }
            });

            document.getElementById('extraLargeText').addEventListener('change', function(e) {
                document.body.classList.toggle('extra-large-text', e.target.checked);
                if (e.target.checked) {
                    document.getElementById('largeText').checked = false;
                    document.body.classList.remove('large-text');
                }
            });

            document.getElementById('audioEnabled').addEventListener('change', function(e) {
                gameState.audioEnabled = e.target.checked;
                document.getElementById('audioBtn').style.display = e.target.checked ? 'block' : 'none';
                if (e.target.checked) {
                    speak('Audio instructions enabled');
                }
            });

            document.getElementById('slowMode').addEventListener('change', function(e) {
                gameState.slowMode = e.target.checked;
            });
        }

        function speak(text) {
            if (gameState.audioEnabled && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = gameState.slowMode ? 0.8 : 1;
                utterance.pitch = 1;
                utterance.volume = 1;
                speechSynthesis.speak(utterance);
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showWelcome() {
            showScreen('welcomeScreen');
            // Hide mobile scenario card
            document.getElementById('mobileScenarioCard').classList.remove('active');
            updateStats();
        }

        function showLevelSelection() {
            showScreen('levelScreen');
            // Hide mobile scenario card
            document.getElementById('mobileScenarioCard').classList.remove('active');
            speak('Choose your practice level');
        }

        function updateStats() {
            document.getElementById('totalPractices').textContent = gameState.stats.totalPractices;
            const rate = gameState.stats.totalPractices > 0 
                ? Math.round((gameState.stats.successfulPractices / gameState.stats.totalPractices) * 100)
                : 0;
            document.getElementById('successRate').textContent = rate + '%';
        }

        function startLevel(level) {
            gameState.currentLevel = level;
            gameState.currentStep = 0;
            gameState.attempts = 0;
            gameState.startTime = Date.now();
            
            // Select random scenario for this level
            const levelScenarios = scenarios[level];
            gameState.currentScenario = levelScenarios[Math.floor(Math.random() * levelScenarios.length)];
            
            // Get steps based on transaction type
            gameState.currentSteps = getStepsForTransaction(level, gameState.currentScenario.transactionType);
            
            // Set total steps
            gameState.totalSteps = gameState.currentSteps.length;
            
            // Set time limit for advanced
            if (level === 'advanced') {
                gameState.timeLimit = 90; // 90 seconds
                startTimer();
                document.getElementById('timerContainer').style.display = 'block';
            } else {
                document.getElementById('timerContainer').style.display = 'none';
            }

            // Show hint card for beginner levels
            if (level === 'learn' || level === 'beginner') {
                document.getElementById('hintCard').style.display = 'block';
            } else if (level === 'intermediate') {
                document.getElementById('hintCard').style.display = 'block';
                document.getElementById('hintButton').textContent = 'Show Hint (Limited)';
            } else {
                document.getElementById('hintCard').style.display = 'none';
            }

            // Display scenario
            updateScenarioDisplay();
            
            showScreen('practiceScreen');
            loadStep();
            
            const transactionWord = gameState.currentScenario.transactionType === 'withdrawal' ? 'withdrawal' : 'deposit';
            speak(`Starting ${level} mode. ${gameState.currentScenario.description}. This is a ${transactionWord} transaction.`);
        }

        function updateScenarioDisplay() {
            const scenario = gameState.currentScenario;
            document.getElementById('accountBalance').textContent = '$' + scenario.balance.toFixed(2);
            
            // Update amount display based on transaction type
            const amountLabel = scenario.transactionType === 'withdrawal' ? 'Withdrawal Amount:' : 'Deposit Amount:';
            const amount = scenario.transactionType === 'withdrawal' ? scenario.withdrawal : scenario.deposit;
            
            // Update the label in the scenario info section (desktop)
            const scenarioInfo = document.getElementById('scenarioInfo');
            scenarioInfo.innerHTML = `
                <p><strong>Account Balance:</strong> <span id="accountBalance">$${scenario.balance.toFixed(2)}</span></p>
                <p><strong>${amountLabel}</strong> <span id="transactionAmount">$${amount.toFixed(2)}</span></p>
                <p><strong>PIN:</strong> <span id="pinNumber">${scenario.pin}</span></p>
                <p><strong>Transaction:</strong> <span style="color: ${scenario.transactionType === 'withdrawal' ? '#dc2626' : '#16a34a'}; font-weight: bold;">${scenario.transactionType.toUpperCase()}</span></p>
            `;

            // Update mobile scenario card
            document.getElementById('mobileBalance').textContent = '$' + scenario.balance.toFixed(2);
            document.getElementById('mobileAmount').textContent = '$' + amount.toFixed(2);
            document.getElementById('mobilePIN').textContent = scenario.pin;
            document.getElementById('mobileTransactionType').textContent = scenario.transactionType.toUpperCase();
            document.getElementById('mobileTransactionType').style.color = scenario.transactionType === 'withdrawal' ? '#fef2f2' : '#f0fdf4';
            
            // Show mobile scenario card
            document.getElementById('mobileScenarioCard').classList.add('active');
        }

        function startTimer() {
            let timeLeft = gameState.timeLimit;
            document.getElementById('timer').textContent = timeLeft;
            
            gameState.timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').classList.add('danger');
                    if (timeLeft === 10) speak('10 seconds remaining');
                } else if (timeLeft <= 30) {
                    document.getElementById('timer').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        function handleTimeout() {
            speak('Time is up. Let\'s try again.');
            showMessage('Time\'s up! Don\'t worry, you\'ll get faster with practice. Let\'s try again!', 'error');
            setTimeout(() => {
                restartPractice();
            }, 3000);
        }

        function loadStep() {
            const level = gameState.currentLevel;
            const step = gameState.currentSteps[gameState.currentStep];
            
            // Update task display (desktop)
            document.getElementById('currentTask').textContent = step.instruction;
            
            // Update progress
            const progress = ((gameState.currentStep) / gameState.totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = Math.round(progress) + '%';
            
            // Update mobile task and progress
            document.getElementById('mobileCurrentTask').textContent = step.instruction;
            document.getElementById('mobileProgressFill').style.width = progress + '%';
            
            // Update stats
            document.getElementById('stepsCompleted').textContent = gameState.currentStep;
            document.getElementById('attemptsCount').textContent = gameState.attempts;
            
            // Clear previous highlights
            document.querySelectorAll('.atm-slot').forEach(slot => {
                slot.classList.remove('highlight', 'correct', 'incorrect');
            });
            
            // Setup step based on action
            setupStepAction(step);
            
            speak(step.instruction);
        }

        function setupStepAction(step) {
            const screenContent = document.getElementById('atmScreenContent');
            const interactive = document.getElementById('screenInteractive');
            interactive.innerHTML = '';
            
            const isWithdrawal = gameState.currentScenario.transactionType === 'withdrawal';
            
            switch(step.action) {
                case 'insertCard':
                    document.getElementById('screenTitle').textContent = 'Welcome!';
                    document.getElementById('screenMessage').textContent = 'Welcome to Career Connections Bank. Please insert your card to begin';
                    if (gameState.currentLevel === 'learn') {
                        highlightSlot('card');
                    }
                    break;
                    
                case 'enterPin':
                    document.getElementById('screenTitle').textContent = 'Enter PIN';
                    document.getElementById('screenMessage').textContent = 'Enter your 4-digit PIN';
                    showKeypad();
                    break;
                    
                case 'selectTransaction':
                    document.getElementById('screenTitle').textContent = 'Select Transaction';
                    document.getElementById('screenMessage').textContent = 'Choose a transaction type';
                    showMainMenu();
                    break;
                    
                case 'enterAmount':
                    if (isWithdrawal) {
                        document.getElementById('screenTitle').textContent = 'Withdrawal Amount';
                        document.getElementById('screenMessage').textContent = 'Enter the amount to withdraw';
                    } else {
                        document.getElementById('screenTitle').textContent = 'Deposit Amount';
                        document.getElementById('screenMessage').textContent = 'Enter the amount to deposit';
                    }
                    showAmountEntry();
                    break;
                    
                case 'completeTransaction':
                    if (isWithdrawal) {
                        document.getElementById('screenTitle').textContent = 'Take Cash';
                        document.getElementById('screenMessage').textContent = 'Please take your cash from the dispenser';
                        if (gameState.currentLevel === 'learn') {
                            highlightSlot('dispenser');
                        }
                    } else {
                        document.getElementById('screenTitle').textContent = 'Insert Deposit';
                        document.getElementById('screenMessage').textContent = 'Please insert your cash or check';
                        if (gameState.currentLevel === 'learn') {
                            highlightSlot('cash');
                        }
                    }
                    break;
                    
                case 'takeReceipt':
                    document.getElementById('screenTitle').textContent = 'Transaction Complete';
                    let newBalance;
                    let message;
                    
                    if (isWithdrawal) {
                        newBalance = gameState.currentScenario.balance - gameState.currentScenario.withdrawal;
                        message = `Withdrawal successful!<br>Amount: $${gameState.currentScenario.withdrawal.toFixed(2)}<br>New Balance: $${newBalance.toFixed(2)}<br>Please take your receipt`;
                    } else {
                        newBalance = gameState.currentScenario.balance + gameState.currentScenario.deposit;
                        message = `Deposit successful!<br>Amount: $${gameState.currentScenario.deposit.toFixed(2)}<br>New Balance: $${newBalance.toFixed(2)}<br>Please take your receipt`;
                    }
                    
                    document.getElementById('screenMessage').innerHTML = message;
                    if (gameState.currentLevel === 'learn') {
                        highlightSlot('receipt');
                    }
                    break;
                    
                case 'takeCard':
                    document.getElementById('screenTitle').textContent = 'Thank You!';
                    document.getElementById('screenMessage').textContent = 'Thank you for banking with Career Connections Bank. Please remove your card';
                    if (gameState.currentLevel === 'learn') {
                        highlightSlot('card');
                    }
                    break;
            }
        }

        function highlightSlot(slotName) {
            const slot = document.querySelector(`[data-slot="${slotName}"]`);
            if (slot) {
                slot.classList.add('highlight');
            }
        }

        function showKeypad() {
            const interactive = document.getElementById('screenInteractive');
            interactive.innerHTML = `
                <div class="input-display" id="pinDisplay">****</div>
                <div class="keypad">
                    ${[1,2,3,4,5,6,7,8,9,'Clear',0,'Enter'].map(key => 
                        `<button class="key ${key === 'Enter' ? 'enter' : ''} ${key === 'Clear' ? 'clear' : ''}" 
                         onclick="pressKey('${key}')">${key}</button>`
                    ).join('')}
                </div>
            `;
        }

        function showMainMenu() {
            const interactive = document.getElementById('screenInteractive');
            const isWithdrawal = gameState.currentScenario.transactionType === 'withdrawal';
            const shouldHighlight = gameState.currentLevel === 'learn';
            
            interactive.innerHTML = `
                <div class="menu-grid">
                    <button class="menu-button ${shouldHighlight && !isWithdrawal ? 'highlight' : ''}" 
                            onclick="selectMenu('deposit')">üí∞ DEPOSIT</button>
                    <button class="menu-button ${shouldHighlight && isWithdrawal ? 'highlight' : ''}" 
                            onclick="selectMenu('withdrawal')">üí∏ WITHDRAWAL</button>
                    <button class="menu-button" onclick="selectMenu('balance')">üìä BALANCE</button>
                    <button class="menu-button" onclick="selectMenu('other')">‚öôÔ∏è OTHER</button>
                </div>
            `;
        }

        function showAmountEntry() {
            const interactive = document.getElementById('screenInteractive');
            interactive.innerHTML = `
                <div class="input-display" id="amountDisplay">$0.00</div>
                <div class="keypad">
                    ${[1,2,3,4,5,6,7,8,9,'Clear',0,'Enter'].map(key => 
                        `<button class="key ${key === 'Enter' ? 'enter' : ''} ${key === 'Clear' ? 'clear' : ''}" 
                         onclick="pressAmountKey('${key}')">${key}</button>`
                    ).join('')}
                </div>
            `;
        }

        function pressKey(key) {
            gameState.attempts++;
            
            if (key === 'Clear') {
                gameState.pinInput = '';
                document.getElementById('pinDisplay').textContent = '****';
                speak('Cleared');
            } else if (key === 'Enter') {
                if (gameState.pinInput === gameState.currentScenario.pin) {
                    correctAction();
                } else {
                    wrongAction('Incorrect PIN. Try again!');
                    gameState.pinInput = '';
                    document.getElementById('pinDisplay').textContent = '****';
                }
            } else {
                if (gameState.pinInput.length < 4) {
                    gameState.pinInput += key;
                    document.getElementById('pinDisplay').textContent = '*'.repeat(gameState.pinInput.length);
                    speak(key);
                }
            }
        }

        function pressAmountKey(key) {
            gameState.attempts++;
            
            if (key === 'Clear') {
                gameState.amountInput = '';
                document.getElementById('amountDisplay').textContent = '$0.00';
                speak('Cleared');
            } else if (key === 'Enter') {
                // Fix: Calculate the amount the same way as the display
                const enteredAmount = parseFloat(gameState.amountInput) / 100 || 0;
                const correctAmount = gameState.currentScenario.transactionType === 'withdrawal' 
                    ? gameState.currentScenario.withdrawal 
                    : gameState.currentScenario.deposit;
                
                if (Math.abs(enteredAmount - correctAmount) < 0.01) {
                    correctAction();
                } else {
                    const actionType = gameState.currentScenario.transactionType === 'withdrawal' ? 'withdraw' : 'deposit';
                    wrongAction(`Incorrect amount. You need to ${actionType} $${correctAmount.toFixed(2)}`);
                    gameState.amountInput = '';
                    document.getElementById('amountDisplay').textContent = '$0.00';
                }
            } else {
                gameState.amountInput += key;
                const amount = parseFloat(gameState.amountInput) / 100;
                document.getElementById('amountDisplay').textContent = '$' + amount.toFixed(2);
                speak(key);
            }
        }

        function selectMenu(option) {
            gameState.attempts++;
            
            const expectedOption = gameState.currentScenario.transactionType === 'withdrawal' ? 'withdrawal' : 'deposit';
            
            if (option === expectedOption) {
                correctAction();
            } else {
                const correctText = expectedOption.toUpperCase();
                wrongAction(`You need to select ${correctText} for this transaction`);
            }
        }

        function clickSlot(slotName) {
            gameState.attempts++;
            const step = gameState.currentSteps[gameState.currentStep];
            const isWithdrawal = gameState.currentScenario.transactionType === 'withdrawal';
            
            let expectedSlot = '';
            switch(step.action) {
                case 'insertCard':
                    expectedSlot = 'card';
                    break;
                case 'completeTransaction':
                    expectedSlot = isWithdrawal ? 'dispenser' : 'cash';
                    break;
                case 'takeReceipt':
                    expectedSlot = 'receipt';
                    break;
                case 'takeCard':
                    expectedSlot = 'card';
                    break;
                default:
                    return; // Not a slot-based action
            }
            
            if (slotName === expectedSlot) {
                correctAction();
            } else {
                wrongAction('That\'s not the right slot for this step');
                const slot = document.querySelector(`[data-slot="${slotName}"]`);
                slot.classList.add('incorrect');
                setTimeout(() => slot.classList.remove('incorrect'), 1000);
            }
        }

        function correctAction() {
            speak('Correct!');
            showMessage('Great job! ‚úì', 'success');
            
            const slot = document.querySelector('.highlight');
            if (slot) {
                slot.classList.remove('highlight');
                slot.classList.add('correct');
            }
            
            gameState.currentStep++;
            
            setTimeout(() => {
                if (gameState.currentStep >= gameState.totalSteps) {
                    completeTransaction();
                } else {
                    loadStep();
                }
            }, gameState.slowMode ? 2000 : 1000);
        }

        function wrongAction(message) {
            speak(message);
            showMessage(message, 'error');
            
            // In learn mode, show hint after mistake
            if (gameState.currentLevel === 'learn') {
                setTimeout(() => showHint(), 1500);
            }
        }

        function showMessage(text, type) {
            const interactive = document.getElementById('screenInteractive');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-box message-${type}`;
            messageDiv.textContent = text;
            interactive.prepend(messageDiv);
            
            setTimeout(() => messageDiv.remove(), 3000);
        }

        function showHint() {
            const step = gameState.currentSteps[gameState.currentStep];
            document.getElementById('hintContent').textContent = step.hint;
            speak(step.hint);
        }

        function completeTransaction() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            const timeElapsed = Math.round((Date.now() - gameState.startTime) / 1000);
            
            // Update stats
            gameState.stats.totalPractices++;
            gameState.stats.successfulPractices++;
            localStorage.setItem('totalPractices', gameState.stats.totalPractices);
            localStorage.setItem('successfulPractices', gameState.stats.successfulPractices);
            
            // Check for new badges
            checkBadges();
            
            // Show completion modal
            document.getElementById('finalSteps').textContent = gameState.totalSteps;
            document.getElementById('finalTime').textContent = timeElapsed + 's';
            
            let message = 'Excellent work! You successfully completed the ATM deposit transaction. ';
            if (gameState.currentLevel === 'learn') {
                message += 'You\'re ready to try Beginner mode!';
            } else if (gameState.currentLevel === 'beginner') {
                message += 'You\'re building great skills! Try Intermediate next!';
            } else if (gameState.currentLevel === 'intermediate') {
                message += 'You\'re doing amazing! Ready for Advanced mode?';
            } else {
                message += 'You\'re a pro! You can confidently use a real ATM now!';
            }
            
            document.getElementById('completionMessage').textContent = message;
            speak(message);
            
            document.getElementById('completionModal').classList.add('active');
        }

        function checkBadges() {
            const badges = gameState.stats.badges;
            let newBadge = null;
            
            if (gameState.stats.totalPractices === 1 && !badges.includes('first')) {
                newBadge = { id: 'first', name: 'First Steps', icon: 'üéØ' };
            } else if (gameState.stats.totalPractices === 5 && !badges.includes('persistent')) {
                newBadge = { id: 'persistent', name: 'Keep Going!', icon: 'üí™' };
            } else if (gameState.stats.totalPractices === 10 && !badges.includes('dedicated')) {
                newBadge = { id: 'dedicated', name: 'Dedicated Learner', icon: '‚≠ê' };
            } else if (gameState.stats.successfulPractices === 10 && !badges.includes('skilled')) {
                newBadge = { id: 'skilled', name: 'ATM Pro', icon: 'üèÜ' };
            }
            
            if (newBadge) {
                badges.push(newBadge.id);
                localStorage.setItem('badges', JSON.stringify(badges));
                document.getElementById('badgeEarned').style.display = 'block';
                document.getElementById('newBadge').textContent = newBadge.icon + ' ' + newBadge.name;
            } else {
                document.getElementById('badgeEarned').style.display = 'none';
            }
        }

        function restartPractice() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            startLevel(gameState.currentLevel);
        }

        function exitPractice() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            showLevelSelection();
        }

        function practiceAgain() {
            document.getElementById('completionModal').classList.remove('active');
            restartPractice();
        }

        function tryNextLevel() {
            document.getElementById('completionModal').classList.remove('active');
            const levels = ['learn', 'beginner', 'intermediate', 'advanced'];
            const currentIndex = levels.indexOf(gameState.currentLevel);
            if (currentIndex < levels.length - 1) {
                startLevel(levels[currentIndex + 1]);
            } else {
                showLevelSelection();
            }
        }

        function exitToLevels() {
            document.getElementById('completionModal').classList.remove('active');
            showLevelSelection();
        }

        function toggleAudio() {
            const checkbox = document.getElementById('audioEnabled');
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        }
    </script>
</body>
</html>
